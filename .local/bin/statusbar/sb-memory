#!/bin/sh

# Memory usage display script (Nerd Fonts compatible version)
# For dwm/st status bar, compatible with Arch Linux Nerd Fonts rendering

case $BUTTON in
	1) notify-send "󰍛 Memory hogs" "$(ps axch -o cmd:15,%mem --sort=-%mem | head)" ;;
	2) "$TERMINAL" -e "$EDITOR" "$0" ;;
    3) setsid -f "$TERMINAL" -e htop ;;
esac

# Error handling: return default prompt if free command fails
if ! free --mebi >/dev/null 2>&1; then
    echo "󰍛 Error" && exit 1
fi

# Extract and format memory usage data (replaced with Nerd Fonts memory icon)
free --mebi | sed -n '2{p;q}' | awk '{
    used = $3
    total = $2
    pct = int(used * 100 / total)
    printf ("%d%%󰍛\n", pct)
}'
