#!/bin/sh

# Prints the current volume or Nerd Fonts mute icon if muted.
# For dwm/st status bar, compatible with Arch Linux Nerd Fonts rendering

case $BUTTON in
	1) setsid -f "$TERMINAL" -e pavucontrol ;;
	2) "$TERMINAL" -e "$EDITOR" "$0" ;;
	3) notify-send "󰕾 Volume module" "\- Shows volume 󰕾/󰖀/󰕿, 󰖁 if muted."
esac

# Error handling: return mute icon if pamixer command fails
if ! command -v pamixer &> /dev/null; then
    echo "󰖁" && exit 1
fi

# Get mute status (handle command return value exceptions)
mute_status=$(pamixer --get-mute 2>/dev/null)
if [ "$mute_status" = "true" ]; then
    echo "󰖁" && exit
fi

# Get volume value (handle empty value)
vol=$(pamixer --get-volume 2>/dev/null)
[ -z "$vol" ] && echo "󰖁" && exit

# Match Nerd Fonts icon based on volume value
if [ "$vol" -gt "70" ]; then
	icon="󰕾"          # High volume
elif [ "$vol" -gt "30" ]; then
	icon="󰖀"          # Medium volume
elif [ "$vol" -gt "0" ]; then
	icon="󰕿"          # Low volume
else
    echo "󰖁" && exit   # Show mute when volume is 0
fi

echo "$vol%$icon"
