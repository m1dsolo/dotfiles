#!/bin/sh

# Prints all batteries, their percentage remaining and an emoji corresponding
# to charge status (Nerd Fonts å›¾æ ‡ç‰ˆ)
# é€‚é…dwm/stçŠ¶æ€æ ï¼Œå…¼å®¹Arch Linux Nerd Fontsæ¸²æŸ“

case $BUTTON in
	3) notify-send "ğŸ”‹ Battery module" "ó°¿: discharging
ó°‚„: not charging
ó°”‘: stagnant charge
ó°‚„: charging
ó°‚…: charged
ó°‚ƒ: battery very low!
- Scroll to change adjust xbacklight." ;;
	4) xbacklight -inc 10 ;;
	5) xbacklight -dec 10 ;;
	6) "$TERMINAL" -e "$EDITOR" "$0" ;;
esac

# åˆå§‹åŒ–å®¹é‡å˜é‡ï¼Œé¿å…ç©ºå€¼åˆ¤æ–­æŠ¥é”™
capacity=""

# Loop through all attached batteries and format the info
for battery in /sys/class/power_supply/BAT?*; do
	# è·³è¿‡ä¸å­˜åœ¨çš„ç”µæ± è·¯å¾„
	[ ! -d "$battery" ] && continue
	
	# If non-first battery, print a space separator.
	[ -n "${capacity}" ] && printf " "
	
	# è¯»å–ç”µæ± çŠ¶æ€å’Œå®¹é‡ï¼Œå¤„ç†è¯»å–å¤±è´¥çš„æƒ…å†µ
	bat_status=$(cat "$battery/status" 2>/dev/null)
	bat_capacity=$(cat "$battery/capacity" 2>/dev/null)
	
	# çŠ¶æ€ä¸ºç©º/å®¹é‡ä¸ºç©ºæ—¶è·³è¿‡ï¼ˆé¿å…è„šæœ¬æŠ¥é”™ï¼‰
	[ -z "$bat_status" ] || [ -z "$bat_capacity" ] && continue

	# Sets up the status and capacity (Nerd Fonts æ ‡å‡†å›¾æ ‡)
	case "$bat_status" in
		"Full") status="ó°‚…" ;;          # å·²å……æ»¡
		"Discharging") status="ó°¿" ;;   # æ”¾ç”µä¸­
		"Charging") status="ó°‚„" ;;      # å……ç”µä¸­
		"Not charging") status="ó°‚„" ;;  # æœªå……ç”µï¼ˆå’Œå……ç”µç”¨åŒä¸€å›¾æ ‡ï¼Œä¹Ÿå¯æ¢ó°”‘ï¼‰
		"Unknown") status="ó°”‘" ;;       # æœªçŸ¥çŠ¶æ€
		*) continue ;;
	esac
	
	capacity="$bat_capacity"
	# Will make a warn variable if discharging and low
	[ "$status" = "ó°¿" ] && [ "$capacity" -le 25 ] && warn="ó°‚ƒ"  # ä½ç”µé‡è­¦å‘Š
	
	# Prints the info (ç§»é™¤\x08é¿å…å…‰æ ‡å›é€€å¯¼è‡´çš„æ˜¾ç¤ºé”™ä¹±)
	printf "%s%s%d%%" "$status" "$warn" "$capacity"; unset warn
done 

# æœ€åæ¢è¡Œï¼Œç¡®ä¿çŠ¶æ€æ æ ¼å¼æ­£ç¡®
[ -n "$capacity" ] && printf "\\n"
