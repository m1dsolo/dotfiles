#!/bin/sh

# Prints battery percentage and icon based on charge status.
# For dwm/st status bar, compatible with Arch Linux Nerd Fonts rendering

case $BUTTON in
	1) setsid -f "$TERMINAL" -e pavucontrol ;;
	2) "$TERMINAL" -e "$EDITOR" "$0" ;;
	3) notify-send "󰾢 Battery module" "\- 󰾢/󰾡/󰾠/󰰎: discharging
- 󰾫/󰾬/󰾭/󰾮: charging" ;;
esac

for battery in /sys/class/power_supply/BAT?*; do
	[ ! -d "$battery" ] && continue

	bat_status=$(cat "$battery/status" 2>/dev/null)
	bat_capacity=$(cat "$battery/capacity" 2>/dev/null)

	[ -z "$bat_status" ] || [ -z "$bat_capacity" ] && continue

	case "$bat_status" in
		"Charging")
			if [ "$bat_capacity" -gt 75 ]; then
				icon="󱊦"
			elif [ "$bat_capacity" -gt 50 ]; then
				icon="󱊥"
			elif [ "$bat_capacity" -gt 25 ]; then
				icon="󱊤"
			else
				icon="󰢟"
			fi
			;;
		"Full") icon="󱊣" ;;
		*)
			if [ "$bat_capacity" -gt 75 ]; then
				icon="󱊣"
			elif [ "$bat_capacity" -gt 50 ]; then
				icon="󱊢"
			elif [ "$bat_capacity" -gt 25 ]; then
				icon="󱊡"
			else
				icon="󰂎"
			fi
			;;
	esac

	printf "%s%%%s" "$bat_capacity" "$icon"
done

printf "\n"
